<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breath Counter ‚Äì Kumbhaka PrƒÅ·πáƒÅyƒÅma</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #111a2b;
      --text: #e8eefc;
      --muted: #90a4c7;
      --accent: #7cc5ff;
      --good: #30d158;
      --warn: #ffd60a;
      --bad: #ff453a;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    }

    body {
      margin: 0;
      background: url('meditation%20image.jpg') center/cover no-repeat, var(--bg);
      color: var(--text);
      display: grid;
      min-height: 100svh;
      place-items: center;
    }

    .app {
      width: min(680px, 95vw);
      padding: 20px;
      background: rgba(17, 26, 43, 0.15);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
      backdrop-filter: blur(8px);
    }

    h1 {
      margin: 0 0 6px;
      font-size: 20px;
      letter-spacing: .5px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .sub {
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 16px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    label {
      font-size: 12px;
      color: var(--muted);
      display: block;
      margin-bottom: 6px
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(34, 48, 74, 0.5);
      background: rgba(14, 23, 40, 0.2);
      color: var(--text);
      font-size: 14px;
    }

    .phase {
      text-align: center;
      padding: 16px;
      border-radius: 16px;
      background: rgba(14, 23, 40, 0.2);
      border: 1px solid rgba(34, 48, 74, 0.5)
    }

    .phase h2 {
      margin: 6px 0 4px;
      font-weight: 700;
      font-size: 18px
    }

    .time {
      font-size: 42px;
      font-variant-numeric: tabular-nums;
      margin: 2px 0 10px;
    }

    .next {
      color: var(--muted);
      font-size: 12px
    }

    .controls {
      display: flex;
      gap: 10px;
      margin: 14px 0 6px;
    }

    button {
      flex: 1;
      padding: 12px 14px;
      border-radius: 12px;
      border: 0;
      font-weight: 600;
      cursor: pointer;
    }

    .primary {
      background: var(--accent);
      color: #06223b
    }

    .ghost {
      background: rgba(14, 23, 40, 0.2);
      color: var(--text);
      border: 1px solid rgba(34, 48, 74, 0.5);
    }

    .danger {
      background: #1f0b10;
      color: #ffd1d1;
      border: 1px solid #512028
    }

    .stats {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .stat {
      flex: 1;
      min-width: 140px;
      background: rgba(14, 23, 40, 0.2);
      border: 1px solid rgba(34, 48, 74, 0.5);
      border-radius: 12px;
      padding: 10px
    }

    .stat .lbl {
      color: var(--muted);
      font-size: 12px
    }

    .stat .val {
      font-size: 20px;
      margin-top: 4px;
      font-variant-numeric: tabular-nums
    }

    .note {
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
      line-height: 1.45
    }

    .bad {
      color: var(--bad)
    }

    .warn {
      color: var(--warn)
    }

    .good {
      color: var(--good)
    }

    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .footer {
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      margin-top: 10px
    }

    .big {
      font-size: 58px;
      text-transform: uppercase;
      letter-spacing: .8px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
    }

    /* Music controls */
    .music-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 8px 12px;
      background: rgba(14, 23, 40, 0.2);
      border-radius: 12px;
      border: 1px solid rgba(34, 48, 74, 0.5);
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    input[type="range"] {
      width: 80px;
      height: 4px;
      background: rgba(34, 48, 74, 0.5);
      border-radius: 2px;
      outline: none;
    }

    /* Progress tracking styles */
    .progress-section {
      margin-top: 14px;
      padding: 12px;
      background: rgba(14, 23, 40, 0.2);
      border-radius: 12px;
      border: 1px solid rgba(34, 48, 74, 0.5);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .progress-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .progress-stat {
      text-align: center;
      padding: 8px;
      background: rgba(14, 23, 40, 0.3);
      border-radius: 8px;
      border: 1px solid rgba(34, 48, 74, 0.3);
    }

    .progress-stat .label {
      font-size: 10px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .progress-stat .value {
      font-size: 16px;
      font-weight: 600;
    }

    .streak {
      color: var(--accent);
    }

    .total-sessions {
      color: var(--good);
    }

    .toggle-progress {
      font-size: 11px;
      padding: 4px 8px;
      background: rgba(124, 197, 255, 0.2);
      border: 1px solid rgba(124, 197, 255, 0.4);
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <main class="app" role="application" aria-label="Kumbhaka PrƒÅ·πáƒÅyƒÅma timer">
    <!-- Hidden audio elements for better control -->
    <audio id="omAudioElement" preload="auto" loop>
      <source src="OM MANTRA MEDITATION 11 Minutes.mp3" type="audio/mpeg">
    </audio>
    <audio id="bellAudioElement" preload="auto">
      <source src="Temple bell sound - village.mp3" type="audio/mpeg">
    </audio>

    <h1>Breath Counter ‚Äì Kumbhaka</h1>
    <div class="sub">Adjust your cycle, tap Start, and follow the prompt. Works offline in your browser.</div>

    <!-- Music Controls -->
    <div class="music-controls">
      <button id="musicToggle" class="ghost" style="flex: none; padding: 6px 12px; font-size: 12px;">üéµ Om
        Music</button>
      <div class="volume-control">
        <span style="font-size: 12px; color: var(--muted);">Vol:</span>
        <input type="range" id="volumeSlider" min="0" max="100" value="30">
        <span id="volumeDisplay" style="font-size: 12px; color: var(--muted); min-width: 25px;">30%</span>
      </div>
    </div>

    <div class="grid" style="margin-bottom:12px">
      <div>
        <label for="preset">Preset</label>
        <select id="preset">
          <option value="">‚Äî Custom ‚Äî</option>
          <option value="4,4,4,4">Box (4-4-4-4)</option>
          <option value="4,7,8,0">4-7-8 (relax)</option>
          <option value="4,16,8,0">Kumbhaka light (4-16-8)</option>
          <option value="5,20,10,0">Kumbhaka+ (5-20-10)</option>
          <option value="6,24,12,0">Advanced (6-24-12)</option>
        </select>
      </div>
      <div class="toggle">
        <input type="checkbox" id="vibrate" checked aria-label="Vibration cues" />
        <label for="vibrate">Vibrate</label>
        <input type="checkbox" id="sound" checked aria-label="Sound cues" style="margin-left:14px" />
        <label for="sound">Sound</label>
        <input type="checkbox" id="autoflow" checked aria-label="Auto repeat cycles" style="margin-left:14px" />
        <label for="autoflow">Auto</label>
        <input type="checkbox" id="music" checked aria-label="Background Om music" style="margin-left:14px" />
        <label for="music">Music</label>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Inhale (sec)</label>
        <input type="number" id="inh" min="1" max="60" step="1" value="4" />
      </div>
      <div>
        <label>Hold (sec)</label>
        <input type="number" id="hold1" min="0" max="120" step="1" value="16" />
      </div>
      <div>
        <label>Exhale (sec)</label>
        <input type="number" id="exh" min="1" max="90" step="1" value="8" />
      </div>
      <div>
        <label>Hold after exhale (sec)</label>
        <input type="number" id="hold2" min="0" max="120" step="1" value="0" />
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label>Target cycles</label>
        <input type="number" id="target" min="1" max="999" value="10" />
      </div>
      <div>
        <label>Countdown before start (sec)</label>
        <input type="number" id="countin" min="0" max="10" value="3" />
      </div>
    </div>

    <section class="phase" aria-live="polite" aria-atomic="true" style="margin-top:14px">
      <div id="phaseName" class="big">Ready</div>
      <div id="phaseTime" class="time">00</div>
      <div class="next"><span id="nextLabel">‚Äî</span></div>
    </section>

    <div class="controls">
      <button id="start" class="primary">Start</button>
      <button id="pause" class="ghost">Pause</button>
      <button id="reset" class="danger">Reset</button>
    </div>

    <div class="stats">
      <div class="stat">
        <div class="lbl">Cycles completed</div>
        <div id="cycles" class="val">0</div>
      </div>
      <div class="stat">
        <div class="lbl">Cycle length</div>
        <div id="cycleLen" class="val">‚Äî s</div>
      </div>
      <div class="stat">
        <div class="lbl">Elapsed</div>
        <div id="elapsed" class="val">00:00</div>
      </div>
    </div>

    <!-- Progress Tracking Section -->
    <div class="progress-section">
      <div class="progress-header">
        <h3 style="margin: 0; font-size: 14px;">Daily Progress</h3>
        <button class="toggle-progress" id="toggleProgress">View History</button>
      </div>
      <div class="progress-stats">
        <div class="progress-stat">
          <div class="label">Today</div>
          <div class="value" id="todaySessions">0</div>
        </div>
        <div class="progress-stat">
          <div class="label">This Week</div>
          <div class="value" id="weekSessions">0</div>
        </div>
        <div class="progress-stat">
          <div class="label">Streak</div>
          <div class="value streak" id="currentStreak">0 days</div>
        </div>
        <div class="progress-stat">
          <div class="label">Total</div>
          <div class="value total-sessions" id="totalSessions">0</div>
        </div>
      </div>
      <div id="progressDetails"
        style="display: none; margin-top: 10px; font-size: 11px; color: var(--muted); max-height: 120px; overflow-y: auto;">
      </div>
    </div>

    <p class="note">
      <strong>Safety:</strong> Practice breath retention gently. Avoid long holds if you have <span
        class="warn">high/low blood pressure</span>, cardiac/respiratory issues, are <span class="warn">pregnant</span>,
      or feel dizzy. Stop immediately if uncomfortable. Start with modest ratios like <span class="good">4‚Äë4‚Äë4‚Äë4</span>
      or <span class="good">4‚Äë7‚Äë8</span> and build gradually. Consider guidance from a qualified teacher.
    </p>

    <div class="footer">Tip: Add to your phone‚Äôs Home screen to use it like an app. Your settings are saved locally.
    </div>
  </main>

  <script>
    // --- Utilities
    const $ = sel => document.querySelector(sel);
    const inputs = { inh: $('#inh'), hold1: $('#hold1'), exh: $('#exh'), hold2: $('#hold2'), target: $('#target'), countin: $('#countin') };
    const toggles = { vibrate: $('#vibrate'), sound: $('#sound'), autoflow: $('#autoflow'), music: $('#music') };
    const labels = { phase: $('#phaseName'), time: $('#phaseTime'), next: $('#nextLabel'), cycles: $('#cycles'), cycleLen: $('#cycleLen'), elapsed: $('#elapsed') };
    const buttons = { start: $('#start'), pause: $('#pause'), reset: $('#reset') };

    const preset = $('#preset');

    // --- Om Music System (Simplified)
    let omAudio = null;
    let templeBellAudio = null;
    let musicPlaying = false;

    function initializeAudio() {
      console.log('Initializing audio...');
      // Get audio elements from DOM
      omAudio = document.getElementById('omAudioElement');
      templeBellAudio = document.getElementById('bellAudioElement');

      if (omAudio) {
        omAudio.volume = 0.3;
        omAudio.addEventListener('error', (e) => console.log('Om audio error:', e));
        omAudio.addEventListener('canplaythrough', () => console.log('Om audio ready'));
      }

      if (templeBellAudio) {
        templeBellAudio.volume = 0.4;
        templeBellAudio.addEventListener('error', (e) => console.log('Bell audio error:', e));
        templeBellAudio.addEventListener('canplaythrough', () => console.log('Bell audio ready'));
      }
    }

    function startOmMusic() {
      console.log('Starting Om music...');
      if (!omAudio) initializeAudio();

      if (omAudio && toggles.music.checked) {
        const volume = $('#volumeSlider').value / 100;
        omAudio.volume = volume;

        const playPromise = omAudio.play();
        if (playPromise) {
          playPromise.then(() => {
            musicPlaying = true;
            $('#musicToggle').textContent = 'üîá Stop Music';
            console.log('Om music playing successfully');
          }).catch(error => {
            console.log('Failed to start Om music:', error);
          });
        }
      }
    }

    function stopOmMusic() {
      console.log('Stopping Om music...');
      if (omAudio && musicPlaying) {
        omAudio.pause();
        omAudio.currentTime = 0;
        musicPlaying = false;
        $('#musicToggle').textContent = 'üéµ Om Music';
        console.log('Om music stopped');
      }
    }

    function toggleOmMusic() {
      if (musicPlaying) {
        stopOmMusic();
      } else {
        startOmMusic();
      }
    }

    // Temple bell sound function
    function playTempleBell() {
      console.log('Playing temple bell...');
      if (!templeBellAudio) initializeAudio();

      if (templeBellAudio && toggles.sound.checked) {
        templeBellAudio.currentTime = 1.5; // Skip first 1.5 seconds
        templeBellAudio.play().catch(e => console.log('Bell play error:', e));
      }
    }

    // Volume control
    $('#volumeSlider').addEventListener('input', (e) => {
      const volume = e.target.value;
      $('#volumeDisplay').textContent = volume + '%';

      if (omAudio) {
        omAudio.volume = volume / 100;
      }
    });

    $('#musicToggle').addEventListener('click', toggleOmMusic);

    // --- Progress Tracking System
    function getTodayKey() {
      return new Date().toISOString().split('T')[0]; // YYYY-MM-DD
    }

    function getWeekKey() {
      const date = new Date();
      const week = Math.ceil(((date - new Date(date.getFullYear(), 0, 1)) / 86400000 + 1) / 7);
      return `${date.getFullYear()}-W${week}`;
    }

    function saveSession(cycles, duration, preset) {
      const today = getTodayKey();
      const sessionData = {
        date: today,
        time: new Date().toTimeString().split(' ')[0],
        cycles: cycles,
        duration: Math.round(duration),
        preset: preset || 'Custom',
        timestamp: Date.now()
      };

      // Get existing sessions
      let sessions = JSON.parse(localStorage.getItem('breathe_sessions') || '[]');
      sessions.push(sessionData);

      // Keep only last 90 days
      const ninetyDaysAgo = Date.now() - (90 * 24 * 60 * 60 * 1000);
      sessions = sessions.filter(s => s.timestamp > ninetyDaysAgo);

      localStorage.setItem('breathe_sessions', JSON.stringify(sessions));
      updateProgressDisplay();
    }

    function getProgressStats() {
      const sessions = JSON.parse(localStorage.getItem('breathe_sessions') || '[]');
      const today = getTodayKey();
      const thisWeek = getWeekKey();

      // Today's sessions
      const todaySessions = sessions.filter(s => s.date === today).length;

      // This week's sessions
      const currentWeekSessions = sessions.filter(s => {
        const sessionDate = new Date(s.date);
        const sessionWeek = getWeekKey();
        return sessionWeek === thisWeek;
      }).length;

      // Calculate streak
      let streak = 0;
      let checkDate = new Date();
      const sessionDates = [...new Set(sessions.map(s => s.date))].sort().reverse();

      while (streak < sessionDates.length) {
        const dateKey = checkDate.toISOString().split('T')[0];
        if (sessionDates.includes(dateKey)) {
          streak++;
          checkDate.setDate(checkDate.getDate() - 1);
        } else if (dateKey === today) {
          // If today has no sessions, check yesterday
          checkDate.setDate(checkDate.getDate() - 1);
        } else {
          break;
        }
      }

      return {
        todaySessions,
        weekSessions: currentWeekSessions,
        streak,
        totalSessions: sessions.length,
        sessions
      };
    }

    function updateProgressDisplay() {
      const stats = getProgressStats();

      $('#todaySessions').textContent = stats.todaySessions;
      $('#weekSessions').textContent = stats.weekSessions;
      $('#currentStreak').textContent = stats.streak + ' days';
      $('#totalSessions').textContent = stats.totalSessions;
    }

    function showProgressDetails() {
      const stats = getProgressStats();
      const details = $('#progressDetails');

      if (details.style.display === 'none') {
        let html = '<strong>Recent Sessions:</strong><br>';
        const recent = stats.sessions.slice(-10).reverse();

        if (recent.length === 0) {
          html += 'No sessions yet. Start your first session!';
        } else {
          recent.forEach(session => {
            html += `${session.date} ${session.time} - ${session.cycles} cycles (${Math.floor(session.duration / 60)}:${(session.duration % 60).toString().padStart(2, '0')})<br>`;
          });
        }

        details.innerHTML = html;
        details.style.display = 'block';
        $('#toggleProgress').textContent = 'Hide History';
      } else {
        details.style.display = 'none';
        $('#toggleProgress').textContent = 'View History';
      }
    }

    $('#toggleProgress').addEventListener('click', showProgressDetails);

    // Web Audio API for cues (disabled during breathing - only at completion)
    let audioCtx = null;
    function beep(dur = 0.06, freq = 880) {
      // No sound during breathing phases - only at completion
      return;
    }

    function vib(p = [40]) {
      if (!toggles.vibrate.checked) return; if (!navigator.vibrate) return;
      navigator.vibrate(p);
    }

    function fmt(s) { return String(s).padStart(2, '0'); }
    function mmss(sec) { sec = Math.max(0, sec | 0); const m = (sec / 60) | 0; const s = sec % 60; return `${fmt(m)}:${fmt(s)}`; }

    function save() {
      const cfg = {
        inh: +inputs.inh.value, hold1: +inputs.hold1.value, exh: +inputs.exh.value, hold2: +inputs.hold2.value,
        target: +inputs.target.value, countin: +inputs.countin.value,
        vibrate: toggles.vibrate.checked, sound: toggles.sound.checked, autoflow: toggles.autoflow.checked, music: toggles.music.checked
      };
      localStorage.setItem('kumbhaka_cfg', JSON.stringify(cfg));
    }
    function load() {
      const raw = localStorage.getItem('kumbhaka_cfg');
      if (!raw) return; try {
        const c = JSON.parse(raw);
        inputs.inh.value = c.inh; inputs.hold1.value = c.hold1; inputs.exh.value = c.exh; inputs.hold2.value = c.hold2;
        inputs.target.value = c.target; inputs.countin.value = c.countin;
        toggles.vibrate.checked = c.vibrate; toggles.sound.checked = c.sound; toggles.autoflow.checked = c.autoflow; toggles.music.checked = c.music;
      } catch (_) { }
    }

    // --- State machine
    const PHASES = ['Inhale', 'Hold', 'Exhale', 'Hold'];
    let schedule = [];
    let iPhase = 0, tRemain = 0, cycles = 0, running = false, tid = null, startedAt = null, elapsedBase = 0;

    function makeSchedule() {
      const i = +inputs.inh.value, h1 = +inputs.hold1.value, e = +inputs.exh.value, h2 = +inputs.hold2.value;
      schedule = [['Inhale', i], ['Hold', h1], ['Exhale', e], ['Hold', h2]].filter(([_, d]) => d > 0);
      const cyc = i + h1 + e + h2; labels.cycleLen.textContent = `${cyc} s`;
    }

    function nextPhase() {
      if (schedule.length === 0) { makeSchedule(); }
      iPhase = (iPhase + 1) % schedule.length;
      const [name, dur] = schedule[iPhase];
      tRemain = dur;
      labels.phase.textContent = name;
      const next = schedule[(iPhase + 1) % schedule.length]?.[0] || '‚Äî';
      labels.next.textContent = `Next: ${next}`;
      beep(0.07, 990); vib([60]);
      if (iPhase === 0) { // new cycle
        cycles += 1; labels.cycles.textContent = cycles;
        // Only stop if we've reached the target AND auto mode is OFF
        if (cycles >= +inputs.target.value && !toggles.autoflow.checked) {
          stop(); return;
        }
        // Show target reached message if in auto mode
        if (cycles >= +inputs.target.value && toggles.autoflow.checked) {
          // Optional: You could add a visual indicator here that target was reached
          labels.cycles.textContent = cycles + ' ‚úì';
        }
      }
    }

    function tick() {
      if (!running) return;
      if (tRemain <= 0) { nextPhase(); }
      labels.time.textContent = fmt(tRemain);
      tRemain -= 1;
      const elapsed = elapsedBase + ((Date.now() - startedAt) | 0);
      labels.elapsed.textContent = mmss(elapsed / 1000);
      tid = setTimeout(tick, 1000);
    }

    function start() {
      save(); makeSchedule();
      if (!running) {
        running = true; startedAt = Date.now();

        // Initialize audio if not done already
        if (!omAudio) initializeAudio();

        // Start Om music if enabled
        if (toggles.music.checked) {
          console.log('Starting Om music...');
          startOmMusic();
        }

        if (labels.phase.textContent === 'Ready') {
          const ci = +inputs.countin.value;
          if (ci > 0) {
            labels.phase.textContent = 'Get Ready'; tRemain = ci; labels.next.textContent = 'Next: Inhale'; labels.time.textContent = fmt(tRemain);
            const ciTick = () => {
              if (!running) return; if (tRemain <= 0) { iPhase = schedule.length - 1; nextPhase(); tick(); return; }
              beep(0.05, 660); vib([30]);
              labels.time.textContent = fmt(tRemain); tRemain -= 1; tid = setTimeout(ciTick, 1000);
            };
            ciTick(); return;
          } else { iPhase = schedule.length - 1; nextPhase(); }
        }
        tick();
      }
    }

    function pause() {
      if (!running) return;
      running = false;
      clearTimeout(tid);
      elapsedBase += (Date.now() - startedAt);
      labels.phase.textContent += ' (paused)';

      // Stop music when paused
      stopOmMusic();
    }

    function stop() {
      running = false;
      clearTimeout(tid);
      iPhase = 0;
      tRemain = 0;
      labels.phase.textContent = 'Done';
      labels.time.textContent = '00';

      // Play temple bell at completion (only when target cycles reached)
      if (cycles > 0 && cycles >= +inputs.target.value) {
        playTempleBell();
      }

      // Stop music and save session
      stopOmMusic();

      // Save the completed session
      if (cycles > 0) {
        const duration = (elapsedBase + (Date.now() - startedAt)) / 1000;
        const currentPreset = preset.value ? preset.options[preset.selectedIndex].text : 'Custom';
        saveSession(cycles, duration, currentPreset);
      }
    }

    function reset() {
      running = false;
      clearTimeout(tid);
      iPhase = 0;
      tRemain = 0;
      cycles = 0;
      labels.cycles.textContent = '0';
      labels.phase.textContent = 'Ready';
      labels.time.textContent = '00';
      labels.next.textContent = '‚Äî';
      labels.elapsed.textContent = '00:00';
      elapsedBase = 0;

      // Stop music when reset
      stopOmMusic();
    }

    // Events
    buttons.start.addEventListener('click', start);
    buttons.pause.addEventListener('click', pause);
    buttons.reset.addEventListener('click', reset);

    preset.addEventListener('change', e => {
      if (!e.target.value) return; const [a, b, c, d] = e.target.value.split(',').map(x => +x);
      inputs.inh.value = a; inputs.hold1.value = b; inputs.exh.value = c; inputs.hold2.value = d; save(); makeSchedule();
    });

    Object.values(inputs).forEach(inp => inp.addEventListener('change', () => { save(); makeSchedule(); }));
    Object.values(toggles).forEach(inp => inp.addEventListener('change', save));

    // Initialize
    load();
    makeSchedule();
    updateProgressDisplay();

    // Initialize audio immediately since we're using HTML audio elements
    initializeAudio();

    // Enable audio context on first user interaction
    let userInteracted = false;
    function enableAudioContext() {
      if (!userInteracted) {
        console.log('User interaction detected - audio context enabled');
        userInteracted = true;
      }
    }

    document.addEventListener('click', enableAudioContext, { once: true });
    document.addEventListener('touchstart', enableAudioContext, { once: true });
  </script>
</body>

</html>